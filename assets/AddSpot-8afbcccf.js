import{l as X,r as v,c as G,L as g,k as a,R as i,Q as l,M as H,N as d,O as c,B as m,S as h,X as x,G as Q,F as Y,V as j,W as J,A as Z}from"./vendor-38d0e5c9.js";import{F as f}from"./fishing-e401f740.js";import{d as ee,a as n,b as te}from"./vant-d7f3bedd.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";const oe={class:"add-spot-page"},se={class:"add-spot-content"},ae={class:"form-section"},ne={class:"form-section"},ie={class:"location-section"},ue={key:0,class:"location-info"},re={class:"location-item"},de={class:"value"},pe={class:"location-item"},ve={class:"value"},ce={class:"form-section"},me={class:"fish-species-tags"},fe={key:0,class:"empty-tip"},_e={class:"form-section"},ge={class:"upload-tip"},ye={class:"location-picker"},ke={class:"picker-header"},he={class:"map-container"},Se={class:"map-background"},be={class:"location-actions"},xe=X({__name:"AddSpot",setup(Ce){const L=H(),t=v({name:"",type:"",typeText:"",description:"",latitude:0,longitude:0,fishSpecies:[],images:[]}),S=v(!1),y=v(""),_=v(!1),k=v(!1),u=v({lat:0,lng:0}),F=[{text:"湖泊",value:f.LAKE},{text:"河流",value:f.RIVER},{text:"水库",value:f.RESERVOIR},{text:"黑坑",value:f.BLACK_PIT},{text:"海钓",value:f.SALTWATER},{text:"淡水",value:f.FRESHWATER}],A=G(()=>t.value.latitude&&t.value.longitude?"已选择位置 (点击重新选择)":"点击选择钓点位置"),M=({selectedOptions:o})=>{const e=o[0];t.value.type=e.value,t.value.typeText=e.text,_.value=!1},$=()=>{k.value=!0,t.value.latitude&&t.value.longitude&&(u.value={lat:t.value.latitude,lng:t.value.longitude})},E=o=>{const e=o.currentTarget.getBoundingClientRect(),r=(o.clientX-e.left)/e.width,p=40-((o.clientY-e.top)/e.height-.5)*.1,b=116+(r-.5)*.1;u.value={lat:p,lng:b},n("位置已选择")},B=()=>{u.value={lat:39.9042+(Math.random()-.5)*.01,lng:116.4074+(Math.random()-.5)*.01},n("已获取当前位置")},U=()=>{u.value.lat&&u.value.lng?(t.value.latitude=u.value.lat,t.value.longitude=u.value.lng,k.value=!1,n("位置已确认")):n("请先选择位置")},N=o=>{const e=((o.lng-116)/.1+.5)*100,r=((40-o.lat)/.1+.5)*100;return{left:`${Math.max(5,Math.min(95,e))}%`,top:`${Math.max(5,Math.min(95,r))}%`}},C=()=>{const o=y.value.trim();o&&!t.value.fishSpecies.includes(o)?(t.value.fishSpecies.push(o),y.value="",n(`已添加 ${o}`)):t.value.fishSpecies.includes(o)&&n("该鱼种已存在")},q=o=>{const e=t.value.fishSpecies[o];t.value.fishSpecies.splice(o,1),n(`已移除 ${e}`)},z=o=>{console.log("上传文件:",o),n("图片上传功能开发中")},I=()=>new Promise(o=>{te({title:"确认删除",message:"确定要删除这张图片吗？"}).then(()=>{o(!0)}).catch(()=>{o(!1)})}),P=()=>t.value.name.trim()?t.value.type?t.value.description.trim()?!t.value.latitude||!t.value.longitude?(n("请选择钓点位置"),!1):t.value.fishSpecies.length===0?(n("请至少添加一种鱼种"),!1):!0:(n("请输入钓点描述"),!1):(n("请选择钓点类型"),!1):(n("请输入钓点名称"),!1),V=async()=>{if(P()){S.value=!0;try{await new Promise(o=>setTimeout(o,2e3)),ee({type:"success",message:"钓点提交成功！等待管理员审核"}),L.replace("/map")}catch{n("提交失败，请重试")}finally{S.value=!1}}};return(o,e)=>{const r=d("van-button"),w=d("van-nav-bar"),p=d("van-field"),b=d("van-tag"),D=d("van-icon"),K=d("van-uploader"),O=d("van-form"),W=d("van-picker"),T=d("van-popup");return c(),g("div",oe,[a(w,{title:"添加钓点","left-arrow":"",onClickLeft:e[0]||(e[0]=s=>o.$router.back())},{right:i(()=>[a(r,{type:"primary",size:"small",loading:S.value,onClick:V},{default:i(()=>e[10]||(e[10]=[m(" 提交 ",-1)])),_:1,__:[10]},8,["loading"])]),_:1}),l("div",se,[a(O,{onSubmit:V},{default:i(()=>[l("div",ae,[e[11]||(e[11]=l("h3",null,"基本信息",-1)),a(p,{modelValue:t.value.name,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.name=s),label:"钓点名称",placeholder:"请输入钓点名称",required:"",rules:[{required:!0,message:"请输入钓点名称"}]},null,8,["modelValue"]),a(p,{modelValue:t.value.typeText,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.typeText=s),label:"钓点类型",placeholder:"请选择钓点类型",readonly:"",required:"",onClick:e[3]||(e[3]=s=>_.value=!0)},null,8,["modelValue"]),a(p,{modelValue:t.value.description,"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.description=s),label:"钓点描述",type:"textarea",placeholder:"请详细描述钓点特色、环境、鱼情等信息...",rows:"3",maxlength:"200","show-word-limit":"",required:"",rules:[{required:!0,message:"请输入钓点描述"}]},null,8,["modelValue"])]),l("div",ne,[e[14]||(e[14]=l("h3",null,"位置信息",-1)),l("div",ie,[a(r,{type:"primary",block:"",icon:"location-o",onClick:$},{default:i(()=>[m(h(A.value),1)]),_:1}),t.value.latitude&&t.value.longitude?(c(),g("div",ue,[l("div",re,[e[12]||(e[12]=l("span",{class:"label"},"纬度:",-1)),l("span",de,h(t.value.latitude.toFixed(6)),1)]),l("div",pe,[e[13]||(e[13]=l("span",{class:"label"},"经度:",-1)),l("span",ve,h(t.value.longitude.toFixed(6)),1)])])):x("",!0)])]),l("div",ce,[e[16]||(e[16]=l("h3",null,"鱼种信息",-1)),a(p,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=s=>y.value=s),label:"可钓鱼种",placeholder:"输入鱼种名称后回车添加",onKeyup:Q(C,["enter"])},{button:i(()=>[a(r,{size:"small",type:"primary",onClick:C},{default:i(()=>e[15]||(e[15]=[m(" 添加 ",-1)])),_:1,__:[15]})]),_:1},8,["modelValue"]),l("div",me,[(c(!0),g(Y,null,j(t.value.fishSpecies,(s,R)=>(c(),J(b,{key:R,type:"primary",closeable:"",onClose:Ve=>q(R)},{default:i(()=>[m(" 🐟 "+h(s),1)]),_:2},1032,["onClose"]))),128)),t.value.fishSpecies.length===0?(c(),g("div",fe," 请添加可钓鱼种 ")):x("",!0)])]),l("div",_e,[e[18]||(e[18]=l("h3",null,"钓点图片",-1)),a(K,{modelValue:t.value.images,"onUpdate:modelValue":e[6]||(e[6]=s=>t.value.images=s),multiple:"","max-count":6,"after-read":z,"before-delete":I},{default:i(()=>[l("div",ge,[a(D,{name:"photograph",size:"24"}),e[17]||(e[17]=l("p",null,"上传钓点图片 (最多6张)",-1))])]),_:1},8,["modelValue"])])]),_:1})]),a(T,{show:_.value,"onUpdate:show":e[8]||(e[8]=s=>_.value=s),position:"bottom"},{default:i(()=>[a(W,{columns:F,onConfirm:M,onCancel:e[7]||(e[7]=s=>_.value=!1)})]),_:1},8,["show"]),a(T,{show:k.value,"onUpdate:show":e[9]||(e[9]=s=>k.value=s),position:"bottom",style:{height:"70%"}},{default:i(()=>[l("div",ye,[l("div",ke,[e[20]||(e[20]=l("h3",null,"选择钓点位置",-1)),a(r,{type:"primary",size:"small",onClick:U},{default:i(()=>e[19]||(e[19]=[m(" 确认位置 ",-1)])),_:1,__:[19]})]),l("div",he,[l("div",{class:"mock-map",onClick:E},[l("div",Se,[e[22]||(e[22]=l("div",{class:"map-grid"},null,-1)),u.value.lat&&u.value.lng?(c(),g("div",{key:0,class:"selected-marker",style:Z(N(u.value))},e[21]||(e[21]=[l("div",{class:"marker-icon"},"📍",-1),l("div",{class:"marker-pulse"},null,-1)]),4)):x("",!0),e[23]||(e[23]=l("div",{class:"map-tip"}," 点击地图选择钓点位置 ",-1))])])]),l("div",be,[a(r,{type:"default",block:"",icon:"aim",onClick:B},{default:i(()=>e[24]||(e[24]=[m(" 使用当前位置 ",-1)])),_:1,__:[24]})])])]),_:1},8,["show"])])}}});const Fe=le(xe,[["__scopeId","data-v-ae96fd17"]]);export{Fe as default};
