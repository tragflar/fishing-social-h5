import{l as X,r as v,c as G,L as g,k as a,R as i,Q as l,M as H,N as d,O as c,B as m,S as h,X as x,G as Q,F as Y,V as j,W as J,A as Z}from"./vendor-38d0e5c9.js";import{F as f}from"./fishing-e401f740.js";import{d as ee,a as n,b as te}from"./vant-d7f3bedd.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";const oe={class:"add-spot-page"},se={class:"add-spot-content"},ae={class:"form-section"},ne={class:"form-section"},ie={class:"location-section"},ue={key:0,class:"location-info"},re={class:"location-item"},de={class:"value"},pe={class:"location-item"},ve={class:"value"},ce={class:"form-section"},me={class:"fish-species-tags"},fe={key:0,class:"empty-tip"},_e={class:"form-section"},ge={class:"upload-tip"},ye={class:"location-picker"},ke={class:"picker-header"},he={class:"map-container"},Se={class:"map-background"},be={class:"location-actions"},xe=X({__name:"AddSpot",setup(Ce){const L=H(),t=v({name:"",type:"",typeText:"",description:"",latitude:0,longitude:0,fishSpecies:[],images:[]}),S=v(!1),y=v(""),_=v(!1),k=v(!1),u=v({lat:0,lng:0}),F=[{text:"æ¹–æ³Š",value:f.LAKE},{text:"æ²³æµ",value:f.RIVER},{text:"æ°´åº“",value:f.RESERVOIR},{text:"é»‘å‘",value:f.BLACK_PIT},{text:"æµ·é’“",value:f.SALTWATER},{text:"æ·¡æ°´",value:f.FRESHWATER}],A=G(()=>t.value.latitude&&t.value.longitude?"å·²é€‰æ‹©ä½ç½® (ç‚¹å‡»é‡æ–°é€‰æ‹©)":"ç‚¹å‡»é€‰æ‹©é’“ç‚¹ä½ç½®"),M=({selectedOptions:o})=>{const e=o[0];t.value.type=e.value,t.value.typeText=e.text,_.value=!1},$=()=>{k.value=!0,t.value.latitude&&t.value.longitude&&(u.value={lat:t.value.latitude,lng:t.value.longitude})},E=o=>{const e=o.currentTarget.getBoundingClientRect(),r=(o.clientX-e.left)/e.width,p=40-((o.clientY-e.top)/e.height-.5)*.1,b=116+(r-.5)*.1;u.value={lat:p,lng:b},n("ä½ç½®å·²é€‰æ‹©")},B=()=>{u.value={lat:39.9042+(Math.random()-.5)*.01,lng:116.4074+(Math.random()-.5)*.01},n("å·²è·å–å½“å‰ä½ç½®")},U=()=>{u.value.lat&&u.value.lng?(t.value.latitude=u.value.lat,t.value.longitude=u.value.lng,k.value=!1,n("ä½ç½®å·²ç¡®è®¤")):n("è¯·å…ˆé€‰æ‹©ä½ç½®")},N=o=>{const e=((o.lng-116)/.1+.5)*100,r=((40-o.lat)/.1+.5)*100;return{left:`${Math.max(5,Math.min(95,e))}%`,top:`${Math.max(5,Math.min(95,r))}%`}},C=()=>{const o=y.value.trim();o&&!t.value.fishSpecies.includes(o)?(t.value.fishSpecies.push(o),y.value="",n(`å·²æ·»åŠ  ${o}`)):t.value.fishSpecies.includes(o)&&n("è¯¥é±¼ç§å·²å­˜åœ¨")},q=o=>{const e=t.value.fishSpecies[o];t.value.fishSpecies.splice(o,1),n(`å·²ç§»é™¤ ${e}`)},z=o=>{console.log("ä¸Šä¼ æ–‡ä»¶:",o),n("å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½å¼€å‘ä¸­")},I=()=>new Promise(o=>{te({title:"ç¡®è®¤åˆ é™¤",message:"ç¡®å®šè¦åˆ é™¤è¿™å¼ å›¾ç‰‡å—ï¼Ÿ"}).then(()=>{o(!0)}).catch(()=>{o(!1)})}),P=()=>t.value.name.trim()?t.value.type?t.value.description.trim()?!t.value.latitude||!t.value.longitude?(n("è¯·é€‰æ‹©é’“ç‚¹ä½ç½®"),!1):t.value.fishSpecies.length===0?(n("è¯·è‡³å°‘æ·»åŠ ä¸€ç§é±¼ç§"),!1):!0:(n("è¯·è¾“å…¥é’“ç‚¹æè¿°"),!1):(n("è¯·é€‰æ‹©é’“ç‚¹ç±»å‹"),!1):(n("è¯·è¾“å…¥é’“ç‚¹åç§°"),!1),V=async()=>{if(P()){S.value=!0;try{await new Promise(o=>setTimeout(o,2e3)),ee({type:"success",message:"é’“ç‚¹æäº¤æˆåŠŸï¼ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸"}),L.replace("/map")}catch{n("æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{S.value=!1}}};return(o,e)=>{const r=d("van-button"),w=d("van-nav-bar"),p=d("van-field"),b=d("van-tag"),D=d("van-icon"),K=d("van-uploader"),O=d("van-form"),W=d("van-picker"),T=d("van-popup");return c(),g("div",oe,[a(w,{title:"æ·»åŠ é’“ç‚¹","left-arrow":"",onClickLeft:e[0]||(e[0]=s=>o.$router.back())},{right:i(()=>[a(r,{type:"primary",size:"small",loading:S.value,onClick:V},{default:i(()=>e[10]||(e[10]=[m(" æäº¤ ",-1)])),_:1,__:[10]},8,["loading"])]),_:1}),l("div",se,[a(O,{onSubmit:V},{default:i(()=>[l("div",ae,[e[11]||(e[11]=l("h3",null,"åŸºæœ¬ä¿¡æ¯",-1)),a(p,{modelValue:t.value.name,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.name=s),label:"é’“ç‚¹åç§°",placeholder:"è¯·è¾“å…¥é’“ç‚¹åç§°",required:"",rules:[{required:!0,message:"è¯·è¾“å…¥é’“ç‚¹åç§°"}]},null,8,["modelValue"]),a(p,{modelValue:t.value.typeText,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.typeText=s),label:"é’“ç‚¹ç±»å‹",placeholder:"è¯·é€‰æ‹©é’“ç‚¹ç±»å‹",readonly:"",required:"",onClick:e[3]||(e[3]=s=>_.value=!0)},null,8,["modelValue"]),a(p,{modelValue:t.value.description,"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.description=s),label:"é’“ç‚¹æè¿°",type:"textarea",placeholder:"è¯·è¯¦ç»†æè¿°é’“ç‚¹ç‰¹è‰²ã€ç¯å¢ƒã€é±¼æƒ…ç­‰ä¿¡æ¯...",rows:"3",maxlength:"200","show-word-limit":"",required:"",rules:[{required:!0,message:"è¯·è¾“å…¥é’“ç‚¹æè¿°"}]},null,8,["modelValue"])]),l("div",ne,[e[14]||(e[14]=l("h3",null,"ä½ç½®ä¿¡æ¯",-1)),l("div",ie,[a(r,{type:"primary",block:"",icon:"location-o",onClick:$},{default:i(()=>[m(h(A.value),1)]),_:1}),t.value.latitude&&t.value.longitude?(c(),g("div",ue,[l("div",re,[e[12]||(e[12]=l("span",{class:"label"},"çº¬åº¦:",-1)),l("span",de,h(t.value.latitude.toFixed(6)),1)]),l("div",pe,[e[13]||(e[13]=l("span",{class:"label"},"ç»åº¦:",-1)),l("span",ve,h(t.value.longitude.toFixed(6)),1)])])):x("",!0)])]),l("div",ce,[e[16]||(e[16]=l("h3",null,"é±¼ç§ä¿¡æ¯",-1)),a(p,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=s=>y.value=s),label:"å¯é’“é±¼ç§",placeholder:"è¾“å…¥é±¼ç§åç§°åå›è½¦æ·»åŠ ",onKeyup:Q(C,["enter"])},{button:i(()=>[a(r,{size:"small",type:"primary",onClick:C},{default:i(()=>e[15]||(e[15]=[m(" æ·»åŠ  ",-1)])),_:1,__:[15]})]),_:1},8,["modelValue"]),l("div",me,[(c(!0),g(Y,null,j(t.value.fishSpecies,(s,R)=>(c(),J(b,{key:R,type:"primary",closeable:"",onClose:Ve=>q(R)},{default:i(()=>[m(" ğŸŸ "+h(s),1)]),_:2},1032,["onClose"]))),128)),t.value.fishSpecies.length===0?(c(),g("div",fe," è¯·æ·»åŠ å¯é’“é±¼ç§ ")):x("",!0)])]),l("div",_e,[e[18]||(e[18]=l("h3",null,"é’“ç‚¹å›¾ç‰‡",-1)),a(K,{modelValue:t.value.images,"onUpdate:modelValue":e[6]||(e[6]=s=>t.value.images=s),multiple:"","max-count":6,"after-read":z,"before-delete":I},{default:i(()=>[l("div",ge,[a(D,{name:"photograph",size:"24"}),e[17]||(e[17]=l("p",null,"ä¸Šä¼ é’“ç‚¹å›¾ç‰‡ (æœ€å¤š6å¼ )",-1))])]),_:1},8,["modelValue"])])]),_:1})]),a(T,{show:_.value,"onUpdate:show":e[8]||(e[8]=s=>_.value=s),position:"bottom"},{default:i(()=>[a(W,{columns:F,onConfirm:M,onCancel:e[7]||(e[7]=s=>_.value=!1)})]),_:1},8,["show"]),a(T,{show:k.value,"onUpdate:show":e[9]||(e[9]=s=>k.value=s),position:"bottom",style:{height:"70%"}},{default:i(()=>[l("div",ye,[l("div",ke,[e[20]||(e[20]=l("h3",null,"é€‰æ‹©é’“ç‚¹ä½ç½®",-1)),a(r,{type:"primary",size:"small",onClick:U},{default:i(()=>e[19]||(e[19]=[m(" ç¡®è®¤ä½ç½® ",-1)])),_:1,__:[19]})]),l("div",he,[l("div",{class:"mock-map",onClick:E},[l("div",Se,[e[22]||(e[22]=l("div",{class:"map-grid"},null,-1)),u.value.lat&&u.value.lng?(c(),g("div",{key:0,class:"selected-marker",style:Z(N(u.value))},e[21]||(e[21]=[l("div",{class:"marker-icon"},"ğŸ“",-1),l("div",{class:"marker-pulse"},null,-1)]),4)):x("",!0),e[23]||(e[23]=l("div",{class:"map-tip"}," ç‚¹å‡»åœ°å›¾é€‰æ‹©é’“ç‚¹ä½ç½® ",-1))])])]),l("div",be,[a(r,{type:"default",block:"",icon:"aim",onClick:B},{default:i(()=>e[24]||(e[24]=[m(" ä½¿ç”¨å½“å‰ä½ç½® ",-1)])),_:1,__:[24]})])])]),_:1},8,["show"])])}}});const Fe=le(xe,[["__scopeId","data-v-ae96fd17"]]);export{Fe as default};
