import{l as e,r as l,c as a,L as t,k as s,R as i,Q as o,M as u,N as n,O as d,B as c,S as v,X as r,G as p,F as m,V as h,W as f,A as g}from"./vendor-1eb17f0c.js";import{F as y}from"./fishing-160c5bf9.js";import{d as _,a as k,b as x}from"./vant-1b65eea4.js";import{_ as b}from"./_plugin-vue_export-helper-1b428a4d.js";const V={class:"add-spot-page"},S={class:"add-spot-content"},w={class:"form-section"},C={class:"form-section"},R={class:"location-section"},T={key:0,class:"location-info"},A={class:"location-item"},E={class:"value"},M={class:"location-item"},U={class:"value"},q={class:"form-section"},F={class:"fish-species-tags"},L={key:0,class:"empty-tip"},$={class:"form-section"},j={class:"upload-tip"},z={class:"location-picker"},I={class:"picker-header"},B={class:"map-container"},K={class:"map-background"},O={class:"location-actions"},P=b(e({__name:"AddSpot",setup(e){const b=u(),P=l({name:"",type:"",typeText:"",description:"",latitude:0,longitude:0,fishSpecies:[],images:[]}),W=l(!1),X=l(""),G=l(!1),H=l(!1),N=l({lat:0,lng:0}),Q=[{text:"湖泊",value:y.LAKE},{text:"河流",value:y.RIVER},{text:"水库",value:y.RESERVOIR},{text:"黑坑",value:y.BLACK_PIT},{text:"海钓",value:y.SALTWATER},{text:"淡水",value:y.FRESHWATER}],Y=a(()=>P.value.latitude&&P.value.longitude?"已选择位置 (点击重新选择)":"点击选择钓点位置"),D=({selectedOptions:e})=>{const l=e[0];P.value.type=l.value,P.value.typeText=l.text,G.value=!1},J=()=>{H.value=!0,P.value.latitude&&P.value.longitude&&(N.value={lat:P.value.latitude,lng:P.value.longitude})},Z=e=>{const l=e.currentTarget.getBoundingClientRect(),a=(e.clientX-l.left)/l.width,t=40-.1*((e.clientY-l.top)/l.height-.5),s=116+.1*(a-.5);N.value={lat:t,lng:s},k("位置已选择")},ee=()=>{N.value={lat:39.9042+.01*(Math.random()-.5),lng:116.4074+.01*(Math.random()-.5)},k("已获取当前位置")},le=()=>{N.value.lat&&N.value.lng?(P.value.latitude=N.value.lat,P.value.longitude=N.value.lng,H.value=!1,k("位置已确认")):k("请先选择位置")},ae=e=>{const l=100*((e.lng-116)/.1+.5),a=100*((40-e.lat)/.1+.5);return{left:`${Math.max(5,Math.min(95,l))}%`,top:`${Math.max(5,Math.min(95,a))}%`}},te=()=>{const e=X.value.trim();e&&!P.value.fishSpecies.includes(e)?(P.value.fishSpecies.push(e),X.value="",k(`已添加 ${e}`)):P.value.fishSpecies.includes(e)&&k("该鱼种已存在")},se=e=>{console.log("上传文件:",e),k("图片上传功能开发中")},ie=()=>new Promise(e=>{x({title:"确认删除",message:"确定要删除这张图片吗？"}).then(()=>{e(!0)}).catch(()=>{e(!1)})}),oe=async()=>{if(P.value.name.trim()?P.value.type?P.value.description.trim()?P.value.latitude&&P.value.longitude?0!==P.value.fishSpecies.length||(k("请至少添加一种鱼种"),0):(k("请选择钓点位置"),0):(k("请输入钓点描述"),0):(k("请选择钓点类型"),0):(k("请输入钓点名称"),0)){W.value=!0;try{await new Promise(e=>setTimeout(e,2e3)),_({type:"success",message:"钓点提交成功！等待管理员审核"}),b.replace("/map")}catch(e){k("提交失败，请重试")}finally{W.value=!1}}};return(e,l)=>{const a=n("van-button"),u=n("van-nav-bar"),y=n("van-field"),_=n("van-tag"),x=n("van-icon"),b=n("van-uploader"),ue=n("van-form"),ne=n("van-picker"),de=n("van-popup");return d(),t("div",V,[s(u,{title:"添加钓点","left-arrow":"",onClickLeft:l[0]||(l[0]=l=>e.$router.back())},{right:i(()=>[s(a,{type:"primary",size:"small",loading:W.value,onClick:oe},{default:i(()=>l[10]||(l[10]=[c(" 提交 ",-1)])),_:1,__:[10]},8,["loading"])]),_:1}),o("div",S,[s(ue,{onSubmit:oe},{default:i(()=>[o("div",w,[l[11]||(l[11]=o("h3",null,"基本信息",-1)),s(y,{modelValue:P.value.name,"onUpdate:modelValue":l[1]||(l[1]=e=>P.value.name=e),label:"钓点名称",placeholder:"请输入钓点名称",required:"",rules:[{required:!0,message:"请输入钓点名称"}]},null,8,["modelValue"]),s(y,{modelValue:P.value.typeText,"onUpdate:modelValue":l[2]||(l[2]=e=>P.value.typeText=e),label:"钓点类型",placeholder:"请选择钓点类型",readonly:"",required:"",onClick:l[3]||(l[3]=e=>G.value=!0)},null,8,["modelValue"]),s(y,{modelValue:P.value.description,"onUpdate:modelValue":l[4]||(l[4]=e=>P.value.description=e),label:"钓点描述",type:"textarea",placeholder:"请详细描述钓点特色、环境、鱼情等信息...",rows:"3",maxlength:"200","show-word-limit":"",required:"",rules:[{required:!0,message:"请输入钓点描述"}]},null,8,["modelValue"])]),o("div",C,[l[14]||(l[14]=o("h3",null,"位置信息",-1)),o("div",R,[s(a,{type:"primary",block:"",icon:"location-o",onClick:J},{default:i(()=>[c(v(Y.value),1)]),_:1}),P.value.latitude&&P.value.longitude?(d(),t("div",T,[o("div",A,[l[12]||(l[12]=o("span",{class:"label"},"纬度:",-1)),o("span",E,v(P.value.latitude.toFixed(6)),1)]),o("div",M,[l[13]||(l[13]=o("span",{class:"label"},"经度:",-1)),o("span",U,v(P.value.longitude.toFixed(6)),1)])])):r("",!0)])]),o("div",q,[l[16]||(l[16]=o("h3",null,"鱼种信息",-1)),s(y,{modelValue:X.value,"onUpdate:modelValue":l[5]||(l[5]=e=>X.value=e),label:"可钓鱼种",placeholder:"输入鱼种名称后回车添加",onKeyup:p(te,["enter"])},{button:i(()=>[s(a,{size:"small",type:"primary",onClick:te},{default:i(()=>l[15]||(l[15]=[c(" 添加 ",-1)])),_:1,__:[15]})]),_:1},8,["modelValue"]),o("div",F,[(d(!0),t(m,null,h(P.value.fishSpecies,(e,l)=>(d(),f(_,{key:l,type:"primary",closeable:"",onClose:e=>(e=>{const l=P.value.fishSpecies[e];P.value.fishSpecies.splice(e,1),k(`已移除 ${l}`)})(l)},{default:i(()=>[c(" 🐟 "+v(e),1)]),_:2},1032,["onClose"]))),128)),0===P.value.fishSpecies.length?(d(),t("div",L," 请添加可钓鱼种 ")):r("",!0)])]),o("div",$,[l[18]||(l[18]=o("h3",null,"钓点图片",-1)),s(b,{modelValue:P.value.images,"onUpdate:modelValue":l[6]||(l[6]=e=>P.value.images=e),multiple:"","max-count":6,"after-read":se,"before-delete":ie},{default:i(()=>[o("div",j,[s(x,{name:"photograph",size:"24"}),l[17]||(l[17]=o("p",null,"上传钓点图片 (最多6张)",-1))])]),_:1},8,["modelValue"])])]),_:1})]),s(de,{show:G.value,"onUpdate:show":l[8]||(l[8]=e=>G.value=e),position:"bottom"},{default:i(()=>[s(ne,{columns:Q,onConfirm:D,onCancel:l[7]||(l[7]=e=>G.value=!1)})]),_:1},8,["show"]),s(de,{show:H.value,"onUpdate:show":l[9]||(l[9]=e=>H.value=e),position:"bottom",style:{height:"70%"}},{default:i(()=>[o("div",z,[o("div",I,[l[20]||(l[20]=o("h3",null,"选择钓点位置",-1)),s(a,{type:"primary",size:"small",onClick:le},{default:i(()=>l[19]||(l[19]=[c(" 确认位置 ",-1)])),_:1,__:[19]})]),o("div",B,[o("div",{class:"mock-map",onClick:Z},[o("div",K,[l[22]||(l[22]=o("div",{class:"map-grid"},null,-1)),N.value.lat&&N.value.lng?(d(),t("div",{key:0,class:"selected-marker",style:g(ae(N.value))},l[21]||(l[21]=[o("div",{class:"marker-icon"},"📍",-1),o("div",{class:"marker-pulse"},null,-1)]),4)):r("",!0),l[23]||(l[23]=o("div",{class:"map-tip"}," 点击地图选择钓点位置 ",-1))])])]),o("div",O,[s(a,{type:"default",block:"",icon:"aim",onClick:ee},{default:i(()=>l[24]||(l[24]=[c(" 使用当前位置 ",-1)])),_:1,__:[24]})])])]),_:1},8,["show"])])}}}),[["__scopeId","data-v-ae96fd17"]]);export{P as default};
