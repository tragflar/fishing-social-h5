import{l as e,r as t,c as a,L as s,k as n,Q as c,_ as r,R as l,Z as o,M as u,N as i,O as d,B as v,S as m,X as h,F as f,V as p,y as g,W as b,$ as y,f as _}from"./vendor-788d0564.js";import{_ as w}from"./_plugin-vue_export-helper-1b428a4d.js";const A={class:"app-layout"},I={class:"content-wrap"},k=w(e({__name:"AppLayout",setup(e){const m=o(),h=u(),f=t(0),p=a(()=>({"/dashboard":"控制台","/recharge":"充值","/transfer":"转账","/records":"交易记录","/profile":"我的","/company-mgmt":"公司管理","/account-mgmt":"账户管理"}[m.path]||"广告充值系统")),g=a(()=>!["/dashboard","/login"].includes(m.path)),b=()=>{"/login"===m.path?h.push("/dashboard"):h.back()};return(e,t)=>{const a=i("van-nav-bar"),o=i("van-tabbar-item"),u=i("van-tabbar");return d(),s("div",A,[n(a,{title:p.value,fixed:"","left-text":g.value?"返回":"","left-arrow":g.value,onClickLeft:b},null,8,["title","left-text","left-arrow"]),c("div",I,[r(e.$slots,"default",{},void 0,!0)]),n(u,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),route:"","safe-area-inset-bottom":""},{default:l(()=>[n(o,{icon:"home-o",to:"/dashboard"},{default:l(()=>[...t[1]||(t[1]=[v("首页",-1)])]),_:1}),n(o,{icon:"balance-o",to:"/recharge"},{default:l(()=>[...t[2]||(t[2]=[v("充值",-1)])]),_:1}),n(o,{icon:"exchange",to:"/transfer"},{default:l(()=>[...t[3]||(t[3]=[v("转账",-1)])]),_:1}),n(o,{icon:"records",to:"/records"},{default:l(()=>[...t[4]||(t[4]=[v("记录",-1)])]),_:1}),n(o,{icon:"user-o",to:"/profile"},{default:l(()=>[...t[5]||(t[5]=[v("我的",-1)])]),_:1})]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-b5b99008"]]),C={class:"transaction-list"},x={class:"filter-section"},D={key:0,class:"statistics-section"},R={class:"custom-card"},T={class:"stat-item"},L={class:"stat-value"},V={class:"stat-item"},F={class:"stat-value amount-text"},P={class:"stat-item"},z={class:"stat-value"},B=["onClick"],S={class:"transaction-status"},U={class:"rebate-info"},N={class:"rebate-text"},$={key:1,class:"load-more-section"},H={key:0,class:"transaction-detail"},j={class:"detail-header"},E=w(e({__name:"TransactionList",props:{transactions:{},accounts:{default:()=>[]},pageSize:{default:10}},setup(e){const r=e,o=t(""),u=t(""),y=t(!1),_=t(!1),w=t(!1),A=t(null),I=t(1),k=t(!1),E=[{text:"全部类型",value:""},{text:"充值",value:"recharge"},{text:"转账",value:"transfer"},{text:"退款",value:"refund"}],M=a(()=>{let e=r.transactions;return o.value&&(e=e.filter(e=>e.type===o.value)),e.sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime())}),O=a(()=>{const e=I.value*r.pageSize;return M.value.slice(0,e)}),Q=a(()=>O.value.length<M.value.length),W=a(()=>M.value.reduce((e,t)=>e+t.amount,0)),X=a(()=>{if(0===M.value.length)return 0;const e=M.value.reduce((e,t)=>e+t.rebateRate,0);return Number((e/M.value.length).toFixed(2))}),Z=e=>e.toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}),q=e=>{switch(e.type){case"recharge":return"账户充值";case"transfer":return"账户转账";case"refund":return"资金退款";default:return"未知交易"}},G=e=>{switch(e){case"recharge":return"充值";case"transfer":return"转账";case"refund":return"退款";default:return"未知"}},J=e=>{switch(e){case"recharge":return"balance-o";case"transfer":return"exchange";case"refund":return"replay";default:return"records"}},K=e=>{switch(e){case"recharge":return"var(--van-success-color)";case"transfer":return"var(--van-primary-color)";case"refund":return"var(--van-warning-color)";default:return"var(--van-text-color-3)"}},Y=e=>{const t=r.accounts.find(t=>t.id===e);return(null==t?void 0:t.name)||"未知账户"},ee=e=>{o.value=e.value,y.value=!1,I.value=1},te=e=>{u.value=e.toLocaleDateString(),_.value=!1,I.value=1},ae=()=>{k.value=!0,setTimeout(()=>{I.value++,k.value=!1},500)};return(e,t)=>{const a=i("van-field"),r=i("van-cell-group"),I=i("van-grid-item"),se=i("van-grid"),ne=i("van-icon"),ce=i("van-cell"),re=i("van-button"),le=i("van-empty"),oe=i("van-picker"),ue=i("van-popup"),ie=i("van-datetime-picker");return d(),s("div",C,[c("div",x,[n(r,null,{default:l(()=>[n(a,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),readonly:"",clickable:"",label:"交易类型",placeholder:o.value||"全部类型",onClick:t[1]||(t[1]=e=>y.value=!0)},null,8,["modelValue","placeholder"]),n(a,{modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),readonly:"",clickable:"",label:"时间范围",placeholder:u.value||"选择时间范围",onClick:t[3]||(t[3]=e=>_.value=!0)},null,8,["modelValue","placeholder"])]),_:1})]),M.value.length>0?(d(),s("div",D,[c("div",R,[n(se,{"column-num":3},{default:l(()=>[n(I,null,{default:l(()=>[c("div",T,[c("div",L,m(M.value.length),1),t[10]||(t[10]=c("div",{class:"stat-label"},"交易笔数",-1))])]),_:1}),n(I,null,{default:l(()=>[c("div",V,[c("div",F,"¥"+m(Z(W.value)),1),t[11]||(t[11]=c("div",{class:"stat-label"},"交易总额",-1))])]),_:1}),n(I,null,{default:l(()=>[c("div",P,[c("div",z,m(X.value)+"%",1),t[12]||(t[12]=c("div",{class:"stat-label"},"平均返点",-1))])]),_:1})]),_:1})])])):h("",!0),n(r,{title:"交易记录"},{default:l(()=>[(d(!0),s(f,null,p(O.value,e=>{return d(),s("div",{key:e.id,class:"transaction-item",onClick:t=>(e=>{A.value=e,w.value=!0})(e)},[n(ce,{title:q(e),value:`¥${Z(e.amount)}`,label:(t=e.timestamp,t.toLocaleDateString("zh-CN")),"is-link":"",class:"custom-cell"},{icon:l(()=>[n(ne,{name:J(e.type),color:K(e.type),size:"20"},null,8,["name","color"])]),"right-icon":l(()=>[c("div",S,[c("span",{class:g(["status-tag","success"])},m("成功"),3),c("div",U,[c("span",N,m(e.rebateRate)+"%",1)])])]),_:2},1032,["title","value","label"])],8,B);var t}),128))]),_:1}),Q.value?(d(),s("div",$,[n(re,{type:"default",size:"small",loading:k.value,onClick:ae},{default:l(()=>[...t[13]||(t[13]=[v(" 加载更多 ",-1)])]),_:1},8,["loading"])])):h("",!0),0===M.value.length?(d(),b(le,{key:2,description:"暂无交易记录",image:"search"})):h("",!0),n(ue,{show:y.value,"onUpdate:show":t[5]||(t[5]=e=>y.value=e),position:"bottom"},{default:l(()=>[n(oe,{columns:E,onConfirm:ee,onCancel:t[4]||(t[4]=e=>y.value=!1)})]),_:1},8,["show"]),n(ue,{show:_.value,"onUpdate:show":t[7]||(t[7]=e=>_.value=e),position:"bottom"},{default:l(()=>[n(ie,{type:"date",onConfirm:te,onCancel:t[6]||(t[6]=e=>_.value=!1)})]),_:1},8,["show"]),n(ue,{show:w.value,"onUpdate:show":t[9]||(t[9]=e=>w.value=e),position:"bottom",style:{height:"60%"}},{default:l(()=>[A.value?(d(),s("div",H,[c("div",j,[t[14]||(t[14]=c("h3",null,"交易详情",-1)),n(re,{type:"default",size:"mini",icon:"cross",onClick:t[8]||(t[8]=e=>w.value=!1)})]),n(r,null,{default:l(()=>{return[n(ce,{title:"交易ID",value:A.value.id},null,8,["value"]),n(ce,{title:"交易类型",value:G(A.value.type)},null,8,["value"]),n(ce,{title:"交易金额",value:`¥${Z(A.value.amount)}`},null,8,["value"]),n(ce,{title:"返点率",value:`${A.value.rebateRate}%`},null,8,["value"]),n(ce,{title:"交易时间",value:(e=A.value.timestamp,e.toLocaleString("zh-CN"))},null,8,["value"]),A.value.from?(d(),b(ce,{key:0,title:"转出账户",value:Y(A.value.from)},null,8,["value"])):h("",!0),A.value.to?(d(),b(ce,{key:1,title:"转入账户",value:Y(A.value.to)},null,8,["value"])):h("",!0)];var e}),_:1})])):h("",!0)]),_:1},8,["show"])])}}}),[["__scopeId","data-v-30034c37"]]),M=y("accounts",{state:()=>({accounts:[],currentAccountId:"",loading:!1,error:null,lastUpdateTime:null,transactionHistory:[],accountCache:new Map}),getters:{currentAccount(){return this.accounts.find(e=>e.id===this.currentAccountId)||null},accountsByCompany(){const e={};return this.accounts.forEach(t=>{e[t.companyId]||(e[t.companyId]=[]),e[t.companyId].push(t)}),e},totalBalance(){return this.accounts.reduce((e,t)=>e+t.balance,0)},averageRebate(){if(0===this.accounts.length)return 0;const e=this.accounts.reduce((e,t)=>e+t.rebate,0);return Number((e/this.accounts.length).toFixed(2))},getAccountTransactions:e=>t=>e.transactionHistory.filter(e=>e.from===t||e.to===t),lowBalanceAccounts(){return this.accounts.filter(e=>e.balance<1e3)},highRebateAccounts(){return this.accounts.filter(e=>e.rebate>=5)},canAccountTransfer:e=>(t,a)=>{const s=e.accounts.find(e=>e.id===t);return!!s&&s.balance>=a},accountStats(){const e=this.accounts.length,t=this.totalBalance,a=e>0?t/e:0,s=this.accounts.filter(e=>e.balance>0).length;return{totalAccounts:e,totalBalance:t,averageBalance:Number(a.toFixed(2)),activeAccounts:s}}},actions:{async loadAccounts(e,t=!1){if(!t&&this.accountCache.has(e)){const t=this.accountCache.get(e);if(t)return void(this.accounts=[...t])}this.loading=!0,this.error=null;try{const t=await this.mockLoadAccountsAPI(e);t.success?(this.accounts=t.accounts,this.lastUpdateTime=new Date,this.accountCache.set(e,[...t.accounts]),!this.currentAccountId&&this.accounts.length>0&&(this.currentAccountId=this.accounts[0].id)):this.error=t.message||"加载账户失败"}catch(a){console.error("Load accounts error:",a),this.error="网络错误，请重试"}finally{this.loading=!1}},setCurrentAccount(e){return!!this.accounts.find(t=>t.id===e)&&(this.currentAccountId=e,!0)},async transferFunds(e){this.loading=!0,this.error=null;try{const t=this.accounts.find(t=>t.id===e.fromAccountId),a=this.accounts.find(t=>t.id===e.toAccountId);if(!t||!a)return{success:!1,message:"账户不存在"};if(t.balance<e.amount)return{success:!1,message:"余额不足"};const s=((e,t,a)=>{const s=a-t;return{actualAmount:parseFloat((e*(1+s/100)).toFixed(2)),rebateDiff:s}})(e.amount,e.fromRebate,e.toRebate),n=await this.mockTransferAPI(e,s);if(n.success){t.balance-=e.amount,a.balance+=s.actualAmount;const n={id:`tx_${Date.now()}`,type:"transfer",amount:e.amount,rebateRate:e.fromRebate,timestamp:new Date,from:e.fromAccountId,to:e.toAccountId};return this.transactionHistory.unshift(n),t.transactions.unshift(n),a.transactions.unshift(n),this.updateAccountCache(t.companyId),t.companyId!==a.companyId&&this.updateAccountCache(a.companyId),{success:!0,message:"转账成功",transaction:n}}return{success:!1,message:n.message||"转账失败"}}catch(t){return console.error("Transfer error:",t),{success:!1,message:"网络错误，请重试"}}finally{this.loading=!1}},async rechargeAccount(e,t){this.loading=!0,this.error=null;try{const a=this.accounts.find(t=>t.id===e);if(!a)return{success:!1,message:"账户不存在"};const s=await this.mockRechargeAPI(e,t);if(s.success){a.balance+=t;const s={id:`tx_${Date.now()}`,type:"recharge",amount:t,rebateRate:a.rebate,timestamp:new Date,to:e};return this.transactionHistory.unshift(s),a.transactions.unshift(s),this.updateAccountCache(a.companyId),{success:!0,message:"充值成功"}}return{success:!1,message:s.message||"充值失败"}}catch(a){return console.error("Recharge error:",a),{success:!1,message:"网络错误，请重试"}}finally{this.loading=!1}},updateAccountCache(e){const t=this.accounts.filter(t=>t.companyId===e);this.accountCache.set(e,[...t])},clearCache(){this.accountCache.clear()},clearError(){this.error=null},async mockLoadAccountsAPI(e){await new Promise(e=>setTimeout(e,1e3));return{success:!0,accounts:[{id:"acc_1",name:"广告账户A",balance:15e3,rebate:3.5,companyId:e,rebateHistory:[{rate:3,effectiveDate:new Date("2023-01-01")},{rate:3.5,effectiveDate:new Date("2023-06-01")}],transactions:[]},{id:"acc_2",name:"广告账户B",balance:8500,rebate:4,companyId:e,rebateHistory:[{rate:3.5,effectiveDate:new Date("2023-01-01")},{rate:4,effectiveDate:new Date("2023-03-01")}],transactions:[]}]}},mockTransferAPI:async(e,t)=>(await new Promise(e=>setTimeout(e,1500)),{success:!0,result:t}),mockRechargeAPI:async(e,t)=>(await new Promise(e=>setTimeout(e,1200)),{success:!0})}}),O=w(e({__name:"Records",setup(e){const s=M(),c=t([{id:"tx_1",type:"recharge",amount:1e3,rebateRate:3.5,timestamp:new Date("2023-12-01 10:30:00")},{id:"tx_2",type:"transfer",amount:500,rebateRate:3.5,timestamp:new Date("2023-12-01 14:20:00"),from:"acc1",to:"acc2"},{id:"tx_3",type:"refund",amount:200,rebateRate:4,timestamp:new Date("2023-12-01 16:45:00")}]),r=a(()=>s.accounts);return _(async()=>{}),(e,t)=>(d(),b(k,null,{default:l(()=>[n(E,{transactions:c.value,accounts:r.value},null,8,["transactions","accounts"])]),_:1}))}}),[["__scopeId","data-v-99b1ba5f"]]);export{O as default};
