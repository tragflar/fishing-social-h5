import{l as e,f as t,L as o,Q as l,S as i,X as a,O as n,r as s,c,k as r,R as u,W as d,M as p,N as m,B as v,F as h,V as _,Y as k}from"./vendor-788d0564.js";import{E as f,M as y}from"./fishing-a433fcef.js";import{b as g,u as C}from"./fishUnlock-20be02ed.js";import{_ as E}from"./_plugin-vue_export-helper-1b428a4d.js";import{a as S,b as I}from"./vant-7a9d22a8.js";const T=e=>{const t=(e=>{try{const t=localStorage.getItem(`userEquipment_${e}`);return t?JSON.parse(t):[]}catch(t){return console.error("获取装备数据失败:",t),[]}})(e),o={totalEquipment:t.length,byType:{}};return Object.values(f).forEach(e=>{o.byType[e]=0}),t.forEach(e=>{o.byType[e.type]++}),o};f.ROD,f.REEL,f.LINE,f.HOOK,f.BAIT,f.ACCESSORY;const O=[{id:"first_fish_unlock",name:"首次钓获",description:"首次钓获某种鱼类",type:y.FISH_UNLOCK,icon:"🎣",color:"#4CAF50",rarity:"common",unlockCondition:"首次钓获任意鱼类",unlockRequirement:{type:"first_fish_unlock",value:1,description:"首次钓获任意鱼类"},isUnlocked:!1},{id:"fish_collect_5",name:"初级收集者",description:"解锁5种鱼类",type:y.FISH_COLLECT,icon:"🐟",color:"#2196F3",rarity:"common",unlockCondition:"累计解锁5种鱼类",unlockRequirement:{type:"fish_collect",value:5,description:"累计解锁5种鱼类"},isUnlocked:!1},{id:"fish_collect_15",name:"中级收集者",description:"解锁15种鱼类",type:y.FISH_COLLECT,icon:"🐠",color:"#9C27B0",rarity:"rare",unlockCondition:"累计解锁15种鱼类",unlockRequirement:{type:"fish_collect",value:15,description:"累计解锁15种鱼类"},isUnlocked:!1},{id:"fish_collect_30",name:"高级收集者",description:"解锁30种鱼类",type:y.FISH_COLLECT,icon:"🐡",color:"#FF9800",rarity:"epic",unlockCondition:"累计解锁30种鱼类",unlockRequirement:{type:"fish_collect",value:30,description:"累计解锁30种鱼类"},isUnlocked:!1},{id:"fish_collect_50",name:"鱼类大师",description:"解锁50种鱼类",type:y.FISH_COLLECT,icon:"🐋",color:"#F44336",rarity:"legendary",unlockCondition:"累计解锁50种鱼类",unlockRequirement:{type:"fish_collect",value:50,description:"累计解锁50种鱼类"},isUnlocked:!1},{id:"catch_100",name:"新手钓手",description:"累计钓获100尾鱼",type:y.CATCH_MILESTONE,icon:"🎯",color:"#4CAF50",rarity:"common",unlockCondition:"累计钓获100尾鱼",unlockRequirement:{type:"total_catch",value:100,description:"累计钓获100尾鱼"},isUnlocked:!1},{id:"catch_500",name:"熟练钓手",description:"累计钓获500尾鱼",type:y.CATCH_MILESTONE,icon:"🎯",color:"#2196F3",rarity:"rare",unlockCondition:"累计钓获500尾鱼",unlockRequirement:{type:"total_catch",value:500,description:"累计钓获500尾鱼"},isUnlocked:!1},{id:"catch_1000",name:"资深钓手",description:"累计钓获1000尾鱼",type:y.CATCH_MILESTONE,icon:"🎯",color:"#9C27B0",rarity:"epic",unlockCondition:"累计钓获1000尾鱼",unlockRequirement:{type:"total_catch",value:1e3,description:"累计钓获1000尾鱼"},isUnlocked:!1},{id:"catch_5000",name:"钓鱼大师",description:"累计钓获5000尾鱼",type:y.CATCH_MILESTONE,icon:"🎯",color:"#F44336",rarity:"legendary",unlockCondition:"累计钓获5000尾鱼",unlockRequirement:{type:"total_catch",value:5e3,description:"累计钓获5000尾鱼"},isUnlocked:!1},{id:"weight_5",name:"小有收获",description:"单次钓获重量达到5公斤",type:y.WEIGHT_MILESTONE,icon:"⚖️",color:"#4CAF50",rarity:"common",unlockCondition:"单次钓获重量达到5公斤",unlockRequirement:{type:"single_weight",value:5,description:"单次钓获重量达到5公斤"},isUnlocked:!1},{id:"weight_10",name:"满载而归",description:"单次钓获重量达到10公斤",type:y.WEIGHT_MILESTONE,icon:"⚖️",color:"#2196F3",rarity:"rare",unlockCondition:"单次钓获重量达到10公斤",unlockRequirement:{type:"single_weight",value:10,description:"单次钓获重量达到10公斤"},isUnlocked:!1},{id:"weight_20",name:"大丰收",description:"单次钓获重量达到20公斤",type:y.WEIGHT_MILESTONE,icon:"⚖️",color:"#9C27B0",rarity:"epic",unlockCondition:"单次钓获重量达到20公斤",unlockRequirement:{type:"single_weight",value:20,description:"单次钓获重量达到20公斤"},isUnlocked:!1},{id:"weight_50",name:"巨物钓手",description:"单次钓获重量达到50公斤",type:y.WEIGHT_MILESTONE,icon:"⚖️",color:"#F44336",rarity:"legendary",unlockCondition:"单次钓获重量达到50公斤",unlockRequirement:{type:"single_weight",value:50,description:"单次钓获重量达到50公斤"},isUnlocked:!1},{id:"diversity_3",name:"多样化",description:"单次钓获3种不同鱼类",type:y.DIVERSITY_MILESTONE,icon:"🌈",color:"#4CAF50",rarity:"common",unlockCondition:"单次钓获3种不同鱼类",unlockRequirement:{type:"single_diversity",value:3,description:"单次钓获3种不同鱼类"},isUnlocked:!1},{id:"diversity_5",name:"丰富收获",description:"单次钓获5种不同鱼类",type:y.DIVERSITY_MILESTONE,icon:"🌈",color:"#2196F3",rarity:"rare",unlockCondition:"单次钓获5种不同鱼类",unlockRequirement:{type:"single_diversity",value:5,description:"单次钓获5种不同鱼类"},isUnlocked:!1},{id:"diversity_8",name:"全能钓手",description:"单次钓获8种不同鱼类",type:y.DIVERSITY_MILESTONE,icon:"🌈",color:"#9C27B0",rarity:"epic",unlockCondition:"单次钓获8种不同鱼类",unlockRequirement:{type:"single_diversity",value:8,description:"单次钓获8种不同鱼类"},isUnlocked:!1}],N=e=>{const t=(e=>{const t=localStorage.getItem(`user_medals_${e}`);if(t)return JSON.parse(t);const o={userId:e,medals:[...O],totalMedals:O.length,unlockedCount:0};return localStorage.setItem(`user_medals_${e}`,JSON.stringify(o)),o})(e),o=(e=>{const t=localStorage.getItem(`user_exp_${e}`);if(t)return JSON.parse(t);const o={currentLevel:"newbie",exp:0,levelExp:0,nextLevelExp:100};return localStorage.setItem(`user_exp_${e}`,JSON.stringify(o)),o})(e),l=g(e),i=T(e),a=[];return O.forEach(n=>{var s;if(!(null==(s=t.medals.find(e=>e.id===n.id))?void 0:s.isUnlocked)){let s=!1;switch(n.type){case y.LEVEL_UP:s=w(n,o);break;case y.FISH_UNLOCK:s=L(n,l);break;case y.FISH_COLLECT:s=R(n,l);break;case y.CATCH_MILESTONE:s=U(n,e);break;case y.WEIGHT_MILESTONE:s=b(n,e);break;case y.DIVERSITY_MILESTONE:s=q(n,e);break;case y.SPOT_CHECKIN:s=x();break;case y.EQUIPMENT_COLLECT:s=F(n,i);break;case y.COMMUNITY_ACTIVE:s=M()}if(s){const o={...n,isUnlocked:!0,unlockedAt:new Date};a.push(o),t.medals.push(o),t.unlockedCount++,((e,t)=>{localStorage.setItem(`user_medals_${e}`,JSON.stringify(t))})(e,t)}}}),a},w=(e,t)=>{var o;const l=(null==(o=e.unlockRequirement)?void 0:o.value)||1;return({newbie:1,intermediate:2,advanced:3,expert:4,master:5,legend:6}[t.currentLevel]||0)>=l},L=(e,t)=>{var o;return"first_fish_unlock"===(null==(o=e.unlockRequirement)?void 0:o.type)&&t.totalUnlocked>0},R=(e,t)=>{var o;if("fish_collect"===(null==(o=e.unlockRequirement)?void 0:o.type)){const o=e.unlockRequirement.value;return t.totalUnlocked>=o}return!1},U=(e,t)=>{var o;if("total_catch"===(null==(o=e.unlockRequirement)?void 0:o.type)){const o=e.unlockRequirement.value;return H(t)>=o}return!1},b=(e,t)=>{var o;if("single_weight"===(null==(o=e.unlockRequirement)?void 0:o.type)){const o=e.unlockRequirement.value;return V(t)>=o}return!1},q=(e,t)=>{var o;if("single_diversity"===(null==(o=e.unlockRequirement)?void 0:o.type)){const o=e.unlockRequirement.value;return A(t)>=o}return!1},x=(e,t)=>!1,F=(e,t)=>{var o;const l=(null==(o=e.unlockRequirement)?void 0:o.value)||0;return t.totalEquipment>=l},M=(e,t)=>!1,H=e=>JSON.parse(localStorage.getItem(`fishing_records_${e}`)||"[]").reduce((e,t)=>e+t.fishCatches.reduce((e,t)=>e+t.count,0),0),V=e=>{const t=JSON.parse(localStorage.getItem(`fishing_records_${e}`)||"[]");let o=0;return t.forEach(e=>{const t=e.fishCatches.reduce((e,t)=>e+t.weight,0);t>o&&(o=t)}),o},A=e=>{const t=JSON.parse(localStorage.getItem(`fishing_records_${e}`)||"[]");let o=0;return t.forEach(e=>{const t=e.fishCatches.length;t>o&&(o=t)}),o},$={key:0,class:"medal-unlock-animation"},J={class:"medal-animation-container"},D={class:"medal-icon"},j={class:"medal-name"},B={class:"medal-description"},Y=E(e({__name:"MedalUnlockAnimation",props:{medal:{},show:{type:Boolean}},emits:["close"],setup(e,{emit:s}){const c=e,r=s;return t(()=>{c.show&&setTimeout(()=>{r("close")},3e3)}),(e,t)=>e.show?(n(),o("div",$,[l("div",J,[l("div",D,i(e.medal.icon),1),l("div",j,i(e.medal.name),1),l("div",B,i(e.medal.description),1),t[0]||(t[0]=l("div",{class:"unlock-text"},"🎉 解锁成功！",-1))])])):a("",!0)}}),[["__scopeId","data-v-3f978c39"]]),z={class:"add-record-page"},W={class:"add-record-content"},G={class:"form-section note-section"},K={class:"note-upload-row"},P={class:"note-upload-icons"},Q={class:"note-images"},X=["src","onClick"],Z={class:"form-section"},ee={key:0,class:"fish-catches-list"},te={class:"fish-catch-header"},oe={class:"fish-species-name"},le={class:"form-section"},ie={class:"image-upload-popup"},ae={class:"upload-tip"},ne=E(e({__name:"AddRecord",setup(e){const t=p(),f=s({spotId:"",spotName:"",images:[],notes:"",fishCatches:[]}),y=s(!1),g=s(""),E=s(!1),T=s(!1),O=s(!1),w=s(!1),L=s(null),R=[{text:"翠湖公园钓点",value:"spot_1"},{text:"野鸭湖水库",value:"spot_2"},{text:"通州运河钓场",value:"spot_3"},{text:"金海湖黑坑",value:"spot_4"}],U=[{text:"鲫鱼",value:"鲫鱼"},{text:"鲤鱼",value:"鲤鱼"},{text:"草鱼",value:"草鱼"},{text:"鲢鱼",value:"鲢鱼"},{text:"青鱼",value:"青鱼"},{text:"鲈鱼",value:"鲈鱼"},{text:"鳊鱼",value:"鳊鱼"},{text:"鲶鱼",value:"鲶鱼"},{text:"黑鱼",value:"黑鱼"},{text:"白条",value:"白条"}],b=c(()=>f.value.fishCatches.some(e=>e.fishSpecies===g.value)),q=({selectedOptions:e})=>{const t=e[0];f.value.spotId=t.value,f.value.spotName=t.text,E.value=!1},x=({selectedOptions:e})=>{g.value=e[0].text,O.value=!1},F=e=>{console.log("上传文件:",e),S("图片上传功能开发中")},M=()=>new Promise(e=>{I({title:"确认删除",message:"确定要删除这张图片吗？"}).then(()=>{e(!0)}).catch(()=>{e(!1)})}),H=()=>{g.value&&!f.value.fishCatches.some(e=>e.fishSpecies===g.value)?(f.value.fishCatches.push({fishSpecies:g.value,count:1,weight:0}),S(`已添加 ${g.value}`),g.value=""):S("该鱼种已添加")},V=async()=>{if(!y.value)if(f.value.spotName)if(0!==f.value.fishCatches.length){y.value=!0;try{const e={id:Date.now().toString(),userId:"current_user",spotId:f.value.spotId,spotName:f.value.spotName,fishCatches:f.value.fishCatches,images:f.value.images,notes:f.value.notes,createTime:(new Date).toISOString()},o=JSON.parse(localStorage.getItem("fishing_records")||"[]");o.push(e),localStorage.setItem("fishing_records",JSON.stringify(o)),f.value.fishCatches.forEach(e=>{C("current_user",e.fishSpecies)});const l=N("current_user");l.length>0?(L.value=l[0],w.value=!0,setTimeout(()=>{S("记录保存成功！"),t.back()},3e3)):(S("记录保存成功！"),t.back())}catch(e){console.error("保存失败:",e),S("保存失败，请重试")}finally{y.value=!1}}else S("请至少添加一种鱼类");else S("请选择钓点")};return(e,t)=>{const s=m("van-button"),c=m("van-nav-bar"),p=m("van-field"),C=m("van-icon"),I=m("van-form"),N=m("van-uploader"),A=m("van-popup"),$=m("van-picker");return n(),o("div",z,[r(c,{title:"添加记录","left-arrow":"",onClickLeft:t[0]||(t[0]=t=>e.$router.back())},{right:u(()=>[r(s,{type:"primary",size:"small",loading:y.value,onClick:V},{default:u(()=>[...t[14]||(t[14]=[v(" 保存 ",-1)])]),_:1},8,["loading"])]),_:1}),l("div",W,[r(I,{onSubmit:V},{default:u(()=>[l("div",G,[t[15]||(t[15]=l("h3",null,"💭 钓获心得",-1)),l("div",K,[r(p,{modelValue:f.value.notes,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value.notes=e),type:"textarea",placeholder:"分享你的钓鱼心得、技巧或感受...",rows:"4",maxlength:"300","show-word-limit":""},null,8,["modelValue"]),l("div",P,[r(C,{name:"photograph",size:"28",class:"upload-icon",onClick:t[2]||(t[2]=e=>T.value=!0)}),l("div",Q,[(n(!0),o(h,null,_(f.value.images,(e,t)=>(n(),o("img",{key:t,src:e.url||e,class:"note-thumb",onClick:e=>{return o=t,void(f.value.images[o]&&f.value.images[o].url?S(`预览图片: ${f.value.images[o].url}`):S(`预览图片: ${f.value.images[o]}`));var o}},null,8,X))),128)),f.value.images.length>0?(n(!0),o(h,{key:0},_(f.value.images,(e,t)=>(n(),d(C,{name:"close",size:"18",class:"img-remove",key:"remove-"+t,onClick:k(e=>{return o=t,f.value.images.splice(o,1),void S("图片已移除");var o},["stop"])},null,8,["onClick"]))),128)):a("",!0)])])])]),l("div",Z,[t[16]||(t[16]=l("h3",null,"🐟 鱼种信息",-1)),r(p,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=e=>g.value=e),label:"选择鱼种",placeholder:"请选择鱼种",readonly:"",onClick:t[4]||(t[4]=e=>O.value=!0)},null,8,["modelValue"]),f.value.fishCatches.length>0?(n(),o("div",ee,[(n(!0),o(h,null,_(f.value.fishCatches,(e,t)=>(n(),o("div",{key:t,class:"fish-catch-item"},[l("div",te,[l("span",oe,i(e.fishSpecies),1),r(C,{name:"close",size:"16",class:"remove-fish",onClick:e=>(e=>{const t=f.value.fishCatches.splice(e,1)[0];S(`已移除 ${t.fishSpecies}`)})(t)},null,8,["onClick"])])]))),128))])):a("",!0),g.value&&!b.value?(n(),d(s,{key:1,type:"primary",size:"small",block:"",onClick:H,class:"add-fish-btn"},{default:u(()=>[v(" 添加 "+i(g.value),1)]),_:1})):a("",!0)]),l("div",le,[t[17]||(t[17]=l("h3",null,"📍 钓点位置",-1)),r(p,{modelValue:f.value.spotName,"onUpdate:modelValue":t[5]||(t[5]=e=>f.value.spotName=e),label:"钓点",placeholder:"请选择钓点",readonly:"",required:"",onClick:t[6]||(t[6]=e=>E.value=!0)},null,8,["modelValue"])])]),_:1})]),r(A,{show:T.value,"onUpdate:show":t[8]||(t[8]=e=>T.value=e),position:"bottom",style:{height:"40%"}},{default:u(()=>[l("div",ie,[r(N,{modelValue:f.value.images,"onUpdate:modelValue":t[7]||(t[7]=e=>f.value.images=e),multiple:"","max-count":9,"after-read":F,"before-delete":M},{default:u(()=>[l("div",ae,[r(C,{name:"photograph",size:"24"}),t[18]||(t[18]=l("p",null,"上传钓获照片 (最多9张)",-1))])]),_:1},8,["modelValue"])])]),_:1},8,["show"]),r(A,{show:O.value,"onUpdate:show":t[10]||(t[10]=e=>O.value=e),position:"bottom"},{default:u(()=>[r($,{columns:U,onConfirm:x,onCancel:t[9]||(t[9]=e=>O.value=!1)})]),_:1},8,["show"]),r(A,{show:E.value,"onUpdate:show":t[12]||(t[12]=e=>E.value=e),position:"bottom"},{default:u(()=>[r($,{columns:R,onConfirm:q,onCancel:t[11]||(t[11]=e=>E.value=!1)})]),_:1},8,["show"]),w.value?(n(),d(Y,{key:0,medal:L.value,show:w.value,onClose:t[13]||(t[13]=e=>w.value=!1)},null,8,["medal","show"])):a("",!0)])}}}),[["__scopeId","data-v-a1c3dfb5"]]);export{ne as default};
