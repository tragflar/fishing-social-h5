import{l as e,f as t,L as o,Q as l,S as i,X as a,O as n,r as s,c,k as r,R as u,W as d,M as p,N as m,B as v,F as h,V as _,Y as k}from"./vendor-788d0564.js";import{E as f,M as y}from"./fishing-a433fcef.js";import{b as g,u as C}from"./fishUnlock-20be02ed.js";import{_ as E}from"./_plugin-vue_export-helper-1b428a4d.js";import{a as S,b as I}from"./vant-7a9d22a8.js";const T=e=>{const t=(e=>{try{const t=localStorage.getItem(`userEquipment_${e}`);return t?JSON.parse(t):[]}catch(t){return console.error("èŽ·å–è£…å¤‡æ•°æ®å¤±è´¥:",t),[]}})(e),o={totalEquipment:t.length,byType:{}};return Object.values(f).forEach(e=>{o.byType[e]=0}),t.forEach(e=>{o.byType[e.type]++}),o};f.ROD,f.REEL,f.LINE,f.HOOK,f.BAIT,f.ACCESSORY;const O=[{id:"first_fish_unlock",name:"é¦–æ¬¡é’“èŽ·",description:"é¦–æ¬¡é’“èŽ·æŸç§é±¼ç±»",type:y.FISH_UNLOCK,icon:"ðŸŽ£",color:"#4CAF50",rarity:"common",unlockCondition:"é¦–æ¬¡é’“èŽ·ä»»æ„é±¼ç±»",unlockRequirement:{type:"first_fish_unlock",value:1,description:"é¦–æ¬¡é’“èŽ·ä»»æ„é±¼ç±»"},isUnlocked:!1},{id:"fish_collect_5",name:"åˆçº§æ”¶é›†è€…",description:"è§£é”5ç§é±¼ç±»",type:y.FISH_COLLECT,icon:"ðŸŸ",color:"#2196F3",rarity:"common",unlockCondition:"ç´¯è®¡è§£é”5ç§é±¼ç±»",unlockRequirement:{type:"fish_collect",value:5,description:"ç´¯è®¡è§£é”5ç§é±¼ç±»"},isUnlocked:!1},{id:"fish_collect_15",name:"ä¸­çº§æ”¶é›†è€…",description:"è§£é”15ç§é±¼ç±»",type:y.FISH_COLLECT,icon:"ðŸ ",color:"#9C27B0",rarity:"rare",unlockCondition:"ç´¯è®¡è§£é”15ç§é±¼ç±»",unlockRequirement:{type:"fish_collect",value:15,description:"ç´¯è®¡è§£é”15ç§é±¼ç±»"},isUnlocked:!1},{id:"fish_collect_30",name:"é«˜çº§æ”¶é›†è€…",description:"è§£é”30ç§é±¼ç±»",type:y.FISH_COLLECT,icon:"ðŸ¡",color:"#FF9800",rarity:"epic",unlockCondition:"ç´¯è®¡è§£é”30ç§é±¼ç±»",unlockRequirement:{type:"fish_collect",value:30,description:"ç´¯è®¡è§£é”30ç§é±¼ç±»"},isUnlocked:!1},{id:"fish_collect_50",name:"é±¼ç±»å¤§å¸ˆ",description:"è§£é”50ç§é±¼ç±»",type:y.FISH_COLLECT,icon:"ðŸ‹",color:"#F44336",rarity:"legendary",unlockCondition:"ç´¯è®¡è§£é”50ç§é±¼ç±»",unlockRequirement:{type:"fish_collect",value:50,description:"ç´¯è®¡è§£é”50ç§é±¼ç±»"},isUnlocked:!1},{id:"catch_100",name:"æ–°æ‰‹é’“æ‰‹",description:"ç´¯è®¡é’“èŽ·100å°¾é±¼",type:y.CATCH_MILESTONE,icon:"ðŸŽ¯",color:"#4CAF50",rarity:"common",unlockCondition:"ç´¯è®¡é’“èŽ·100å°¾é±¼",unlockRequirement:{type:"total_catch",value:100,description:"ç´¯è®¡é’“èŽ·100å°¾é±¼"},isUnlocked:!1},{id:"catch_500",name:"ç†Ÿç»ƒé’“æ‰‹",description:"ç´¯è®¡é’“èŽ·500å°¾é±¼",type:y.CATCH_MILESTONE,icon:"ðŸŽ¯",color:"#2196F3",rarity:"rare",unlockCondition:"ç´¯è®¡é’“èŽ·500å°¾é±¼",unlockRequirement:{type:"total_catch",value:500,description:"ç´¯è®¡é’“èŽ·500å°¾é±¼"},isUnlocked:!1},{id:"catch_1000",name:"èµ„æ·±é’“æ‰‹",description:"ç´¯è®¡é’“èŽ·1000å°¾é±¼",type:y.CATCH_MILESTONE,icon:"ðŸŽ¯",color:"#9C27B0",rarity:"epic",unlockCondition:"ç´¯è®¡é’“èŽ·1000å°¾é±¼",unlockRequirement:{type:"total_catch",value:1e3,description:"ç´¯è®¡é’“èŽ·1000å°¾é±¼"},isUnlocked:!1},{id:"catch_5000",name:"é’“é±¼å¤§å¸ˆ",description:"ç´¯è®¡é’“èŽ·5000å°¾é±¼",type:y.CATCH_MILESTONE,icon:"ðŸŽ¯",color:"#F44336",rarity:"legendary",unlockCondition:"ç´¯è®¡é’“èŽ·5000å°¾é±¼",unlockRequirement:{type:"total_catch",value:5e3,description:"ç´¯è®¡é’“èŽ·5000å°¾é±¼"},isUnlocked:!1},{id:"weight_5",name:"å°æœ‰æ”¶èŽ·",description:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°5å…¬æ–¤",type:y.WEIGHT_MILESTONE,icon:"âš–ï¸",color:"#4CAF50",rarity:"common",unlockCondition:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°5å…¬æ–¤",unlockRequirement:{type:"single_weight",value:5,description:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°5å…¬æ–¤"},isUnlocked:!1},{id:"weight_10",name:"æ»¡è½½è€Œå½’",description:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°10å…¬æ–¤",type:y.WEIGHT_MILESTONE,icon:"âš–ï¸",color:"#2196F3",rarity:"rare",unlockCondition:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°10å…¬æ–¤",unlockRequirement:{type:"single_weight",value:10,description:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°10å…¬æ–¤"},isUnlocked:!1},{id:"weight_20",name:"å¤§ä¸°æ”¶",description:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°20å…¬æ–¤",type:y.WEIGHT_MILESTONE,icon:"âš–ï¸",color:"#9C27B0",rarity:"epic",unlockCondition:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°20å…¬æ–¤",unlockRequirement:{type:"single_weight",value:20,description:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°20å…¬æ–¤"},isUnlocked:!1},{id:"weight_50",name:"å·¨ç‰©é’“æ‰‹",description:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°50å…¬æ–¤",type:y.WEIGHT_MILESTONE,icon:"âš–ï¸",color:"#F44336",rarity:"legendary",unlockCondition:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°50å…¬æ–¤",unlockRequirement:{type:"single_weight",value:50,description:"å•æ¬¡é’“èŽ·é‡é‡è¾¾åˆ°50å…¬æ–¤"},isUnlocked:!1},{id:"diversity_3",name:"å¤šæ ·åŒ–",description:"å•æ¬¡é’“èŽ·3ç§ä¸åŒé±¼ç±»",type:y.DIVERSITY_MILESTONE,icon:"ðŸŒˆ",color:"#4CAF50",rarity:"common",unlockCondition:"å•æ¬¡é’“èŽ·3ç§ä¸åŒé±¼ç±»",unlockRequirement:{type:"single_diversity",value:3,description:"å•æ¬¡é’“èŽ·3ç§ä¸åŒé±¼ç±»"},isUnlocked:!1},{id:"diversity_5",name:"ä¸°å¯Œæ”¶èŽ·",description:"å•æ¬¡é’“èŽ·5ç§ä¸åŒé±¼ç±»",type:y.DIVERSITY_MILESTONE,icon:"ðŸŒˆ",color:"#2196F3",rarity:"rare",unlockCondition:"å•æ¬¡é’“èŽ·5ç§ä¸åŒé±¼ç±»",unlockRequirement:{type:"single_diversity",value:5,description:"å•æ¬¡é’“èŽ·5ç§ä¸åŒé±¼ç±»"},isUnlocked:!1},{id:"diversity_8",name:"å…¨èƒ½é’“æ‰‹",description:"å•æ¬¡é’“èŽ·8ç§ä¸åŒé±¼ç±»",type:y.DIVERSITY_MILESTONE,icon:"ðŸŒˆ",color:"#9C27B0",rarity:"epic",unlockCondition:"å•æ¬¡é’“èŽ·8ç§ä¸åŒé±¼ç±»",unlockRequirement:{type:"single_diversity",value:8,description:"å•æ¬¡é’“èŽ·8ç§ä¸åŒé±¼ç±»"},isUnlocked:!1}],N=e=>{const t=(e=>{const t=localStorage.getItem(`user_medals_${e}`);if(t)return JSON.parse(t);const o={userId:e,medals:[...O],totalMedals:O.length,unlockedCount:0};return localStorage.setItem(`user_medals_${e}`,JSON.stringify(o)),o})(e),o=(e=>{const t=localStorage.getItem(`user_exp_${e}`);if(t)return JSON.parse(t);const o={currentLevel:"newbie",exp:0,levelExp:0,nextLevelExp:100};return localStorage.setItem(`user_exp_${e}`,JSON.stringify(o)),o})(e),l=g(e),i=T(e),a=[];return O.forEach(n=>{var s;if(!(null==(s=t.medals.find(e=>e.id===n.id))?void 0:s.isUnlocked)){let s=!1;switch(n.type){case y.LEVEL_UP:s=w(n,o);break;case y.FISH_UNLOCK:s=L(n,l);break;case y.FISH_COLLECT:s=R(n,l);break;case y.CATCH_MILESTONE:s=U(n,e);break;case y.WEIGHT_MILESTONE:s=b(n,e);break;case y.DIVERSITY_MILESTONE:s=q(n,e);break;case y.SPOT_CHECKIN:s=x();break;case y.EQUIPMENT_COLLECT:s=F(n,i);break;case y.COMMUNITY_ACTIVE:s=M()}if(s){const o={...n,isUnlocked:!0,unlockedAt:new Date};a.push(o),t.medals.push(o),t.unlockedCount++,((e,t)=>{localStorage.setItem(`user_medals_${e}`,JSON.stringify(t))})(e,t)}}}),a},w=(e,t)=>{var o;const l=(null==(o=e.unlockRequirement)?void 0:o.value)||1;return({newbie:1,intermediate:2,advanced:3,expert:4,master:5,legend:6}[t.currentLevel]||0)>=l},L=(e,t)=>{var o;return"first_fish_unlock"===(null==(o=e.unlockRequirement)?void 0:o.type)&&t.totalUnlocked>0},R=(e,t)=>{var o;if("fish_collect"===(null==(o=e.unlockRequirement)?void 0:o.type)){const o=e.unlockRequirement.value;return t.totalUnlocked>=o}return!1},U=(e,t)=>{var o;if("total_catch"===(null==(o=e.unlockRequirement)?void 0:o.type)){const o=e.unlockRequirement.value;return H(t)>=o}return!1},b=(e,t)=>{var o;if("single_weight"===(null==(o=e.unlockRequirement)?void 0:o.type)){const o=e.unlockRequirement.value;return V(t)>=o}return!1},q=(e,t)=>{var o;if("single_diversity"===(null==(o=e.unlockRequirement)?void 0:o.type)){const o=e.unlockRequirement.value;return A(t)>=o}return!1},x=(e,t)=>!1,F=(e,t)=>{var o;const l=(null==(o=e.unlockRequirement)?void 0:o.value)||0;return t.totalEquipment>=l},M=(e,t)=>!1,H=e=>JSON.parse(localStorage.getItem(`fishing_records_${e}`)||"[]").reduce((e,t)=>e+t.fishCatches.reduce((e,t)=>e+t.count,0),0),V=e=>{const t=JSON.parse(localStorage.getItem(`fishing_records_${e}`)||"[]");let o=0;return t.forEach(e=>{const t=e.fishCatches.reduce((e,t)=>e+t.weight,0);t>o&&(o=t)}),o},A=e=>{const t=JSON.parse(localStorage.getItem(`fishing_records_${e}`)||"[]");let o=0;return t.forEach(e=>{const t=e.fishCatches.length;t>o&&(o=t)}),o},$={key:0,class:"medal-unlock-animation"},J={class:"medal-animation-container"},D={class:"medal-icon"},j={class:"medal-name"},B={class:"medal-description"},Y=E(e({__name:"MedalUnlockAnimation",props:{medal:{},show:{type:Boolean}},emits:["close"],setup(e,{emit:s}){const c=e,r=s;return t(()=>{c.show&&setTimeout(()=>{r("close")},3e3)}),(e,t)=>e.show?(n(),o("div",$,[l("div",J,[l("div",D,i(e.medal.icon),1),l("div",j,i(e.medal.name),1),l("div",B,i(e.medal.description),1),t[0]||(t[0]=l("div",{class:"unlock-text"},"ðŸŽ‰ è§£é”æˆåŠŸï¼",-1))])])):a("",!0)}}),[["__scopeId","data-v-3f978c39"]]),z={class:"add-record-page"},W={class:"add-record-content"},G={class:"form-section note-section"},K={class:"note-upload-row"},P={class:"note-upload-icons"},Q={class:"note-images"},X=["src","onClick"],Z={class:"form-section"},ee={key:0,class:"fish-catches-list"},te={class:"fish-catch-header"},oe={class:"fish-species-name"},le={class:"form-section"},ie={class:"image-upload-popup"},ae={class:"upload-tip"},ne=E(e({__name:"AddRecord",setup(e){const t=p(),f=s({spotId:"",spotName:"",images:[],notes:"",fishCatches:[]}),y=s(!1),g=s(""),E=s(!1),T=s(!1),O=s(!1),w=s(!1),L=s(null),R=[{text:"ç¿ æ¹–å…¬å›­é’“ç‚¹",value:"spot_1"},{text:"é‡Žé¸­æ¹–æ°´åº“",value:"spot_2"},{text:"é€šå·žè¿æ²³é’“åœº",value:"spot_3"},{text:"é‡‘æµ·æ¹–é»‘å‘",value:"spot_4"}],U=[{text:"é²«é±¼",value:"é²«é±¼"},{text:"é²¤é±¼",value:"é²¤é±¼"},{text:"è‰é±¼",value:"è‰é±¼"},{text:"é²¢é±¼",value:"é²¢é±¼"},{text:"é’é±¼",value:"é’é±¼"},{text:"é²ˆé±¼",value:"é²ˆé±¼"},{text:"é³Šé±¼",value:"é³Šé±¼"},{text:"é²¶é±¼",value:"é²¶é±¼"},{text:"é»‘é±¼",value:"é»‘é±¼"},{text:"ç™½æ¡",value:"ç™½æ¡"}],b=c(()=>f.value.fishCatches.some(e=>e.fishSpecies===g.value)),q=({selectedOptions:e})=>{const t=e[0];f.value.spotId=t.value,f.value.spotName=t.text,E.value=!1},x=({selectedOptions:e})=>{g.value=e[0].text,O.value=!1},F=e=>{console.log("ä¸Šä¼ æ–‡ä»¶:",e),S("å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½å¼€å‘ä¸­")},M=()=>new Promise(e=>{I({title:"ç¡®è®¤åˆ é™¤",message:"ç¡®å®šè¦åˆ é™¤è¿™å¼ å›¾ç‰‡å—ï¼Ÿ"}).then(()=>{e(!0)}).catch(()=>{e(!1)})}),H=()=>{g.value&&!f.value.fishCatches.some(e=>e.fishSpecies===g.value)?(f.value.fishCatches.push({fishSpecies:g.value,count:1,weight:0}),S(`å·²æ·»åŠ  ${g.value}`),g.value=""):S("è¯¥é±¼ç§å·²æ·»åŠ ")},V=async()=>{if(!y.value)if(f.value.spotName)if(0!==f.value.fishCatches.length){y.value=!0;try{const e={id:Date.now().toString(),userId:"current_user",spotId:f.value.spotId,spotName:f.value.spotName,fishCatches:f.value.fishCatches,images:f.value.images,notes:f.value.notes,createTime:(new Date).toISOString()},o=JSON.parse(localStorage.getItem("fishing_records")||"[]");o.push(e),localStorage.setItem("fishing_records",JSON.stringify(o)),f.value.fishCatches.forEach(e=>{C("current_user",e.fishSpecies)});const l=N("current_user");l.length>0?(L.value=l[0],w.value=!0,setTimeout(()=>{S("è®°å½•ä¿å­˜æˆåŠŸï¼"),t.back()},3e3)):(S("è®°å½•ä¿å­˜æˆåŠŸï¼"),t.back())}catch(e){console.error("ä¿å­˜å¤±è´¥:",e),S("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{y.value=!1}}else S("è¯·è‡³å°‘æ·»åŠ ä¸€ç§é±¼ç±»");else S("è¯·é€‰æ‹©é’“ç‚¹")};return(e,t)=>{const s=m("van-button"),c=m("van-nav-bar"),p=m("van-field"),C=m("van-icon"),I=m("van-form"),N=m("van-uploader"),A=m("van-popup"),$=m("van-picker");return n(),o("div",z,[r(c,{title:"æ·»åŠ è®°å½•","left-arrow":"",onClickLeft:t[0]||(t[0]=t=>e.$router.back())},{right:u(()=>[r(s,{type:"primary",size:"small",loading:y.value,onClick:V},{default:u(()=>[...t[14]||(t[14]=[v(" ä¿å­˜ ",-1)])]),_:1},8,["loading"])]),_:1}),l("div",W,[r(I,{onSubmit:V},{default:u(()=>[l("div",G,[t[15]||(t[15]=l("h3",null,"ðŸ’­ é’“èŽ·å¿ƒå¾—",-1)),l("div",K,[r(p,{modelValue:f.value.notes,"onUpdate:modelValue":t[1]||(t[1]=e=>f.value.notes=e),type:"textarea",placeholder:"åˆ†äº«ä½ çš„é’“é±¼å¿ƒå¾—ã€æŠ€å·§æˆ–æ„Ÿå—...",rows:"4",maxlength:"300","show-word-limit":""},null,8,["modelValue"]),l("div",P,[r(C,{name:"photograph",size:"28",class:"upload-icon",onClick:t[2]||(t[2]=e=>T.value=!0)}),l("div",Q,[(n(!0),o(h,null,_(f.value.images,(e,t)=>(n(),o("img",{key:t,src:e.url||e,class:"note-thumb",onClick:e=>{return o=t,void(f.value.images[o]&&f.value.images[o].url?S(`é¢„è§ˆå›¾ç‰‡: ${f.value.images[o].url}`):S(`é¢„è§ˆå›¾ç‰‡: ${f.value.images[o]}`));var o}},null,8,X))),128)),f.value.images.length>0?(n(!0),o(h,{key:0},_(f.value.images,(e,t)=>(n(),d(C,{name:"close",size:"18",class:"img-remove",key:"remove-"+t,onClick:k(e=>{return o=t,f.value.images.splice(o,1),void S("å›¾ç‰‡å·²ç§»é™¤");var o},["stop"])},null,8,["onClick"]))),128)):a("",!0)])])])]),l("div",Z,[t[16]||(t[16]=l("h3",null,"ðŸŸ é±¼ç§ä¿¡æ¯",-1)),r(p,{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=e=>g.value=e),label:"é€‰æ‹©é±¼ç§",placeholder:"è¯·é€‰æ‹©é±¼ç§",readonly:"",onClick:t[4]||(t[4]=e=>O.value=!0)},null,8,["modelValue"]),f.value.fishCatches.length>0?(n(),o("div",ee,[(n(!0),o(h,null,_(f.value.fishCatches,(e,t)=>(n(),o("div",{key:t,class:"fish-catch-item"},[l("div",te,[l("span",oe,i(e.fishSpecies),1),r(C,{name:"close",size:"16",class:"remove-fish",onClick:e=>(e=>{const t=f.value.fishCatches.splice(e,1)[0];S(`å·²ç§»é™¤ ${t.fishSpecies}`)})(t)},null,8,["onClick"])])]))),128))])):a("",!0),g.value&&!b.value?(n(),d(s,{key:1,type:"primary",size:"small",block:"",onClick:H,class:"add-fish-btn"},{default:u(()=>[v(" æ·»åŠ  "+i(g.value),1)]),_:1})):a("",!0)]),l("div",le,[t[17]||(t[17]=l("h3",null,"ðŸ“ é’“ç‚¹ä½ç½®",-1)),r(p,{modelValue:f.value.spotName,"onUpdate:modelValue":t[5]||(t[5]=e=>f.value.spotName=e),label:"é’“ç‚¹",placeholder:"è¯·é€‰æ‹©é’“ç‚¹",readonly:"",required:"",onClick:t[6]||(t[6]=e=>E.value=!0)},null,8,["modelValue"])])]),_:1})]),r(A,{show:T.value,"onUpdate:show":t[8]||(t[8]=e=>T.value=e),position:"bottom",style:{height:"40%"}},{default:u(()=>[l("div",ie,[r(N,{modelValue:f.value.images,"onUpdate:modelValue":t[7]||(t[7]=e=>f.value.images=e),multiple:"","max-count":9,"after-read":F,"before-delete":M},{default:u(()=>[l("div",ae,[r(C,{name:"photograph",size:"24"}),t[18]||(t[18]=l("p",null,"ä¸Šä¼ é’“èŽ·ç…§ç‰‡ (æœ€å¤š9å¼ )",-1))])]),_:1},8,["modelValue"])])]),_:1},8,["show"]),r(A,{show:O.value,"onUpdate:show":t[10]||(t[10]=e=>O.value=e),position:"bottom"},{default:u(()=>[r($,{columns:U,onConfirm:x,onCancel:t[9]||(t[9]=e=>O.value=!1)})]),_:1},8,["show"]),r(A,{show:E.value,"onUpdate:show":t[12]||(t[12]=e=>E.value=e),position:"bottom"},{default:u(()=>[r($,{columns:R,onConfirm:q,onCancel:t[11]||(t[11]=e=>E.value=!1)})]),_:1},8,["show"]),w.value?(n(),d(Y,{key:0,medal:L.value,show:w.value,onClose:t[13]||(t[13]=e=>w.value=!1)},null,8,["medal","show"])):a("",!0)])}}}),[["__scopeId","data-v-a1c3dfb5"]]);export{ne as default};
